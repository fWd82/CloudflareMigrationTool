!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,r){(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}!function o(n,i,a){function s(r,e){if(!i[r]){if(!n[r]){var t="function"==typeof commonjsRequire&&commonjsRequire;if(!e&&t)return t(r,!0);if(l)return l(r,!0);e=new Error("Cannot find module '"+r+"'");throw e.code="MODULE_NOT_FOUND",e}t=i[r]={exports:{}};n[r][0].call(t.exports,function(e){var t=n[r][1][e];return s(t||e)},t,t.exports,o,n,i,a)}return i[r].exports}for(var l="function"==typeof commonjsRequire&&commonjsRequire,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,r){function o(n){var a=function(e,t){return e+t&4294967295},o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function s(e,t,r,o,n,i){return t=a(a(t,e),a(o,i)),a(t<<n|t>>>32-n,r)}function l(e,t,r,o,n,i,a){return s(t&r|~t&o,e,t,n,i,a)}function u(e,t,r,o,n,i,a){return s(t&o|r&~o,e,t,n,i,a)}function p(e,t,r,o,n,i,a){return s(t^r^o,e,t,n,i,a)}function d(e,t,r,o,n,i,a){return s(r^(t|~o),e,t,n,i,a)}function c(e,t){var r=l(e[0],i=e[1],n=e[2],o=e[3],t[0],7,-680876936),o=l(o,r,i,n,t[1],12,-389564586),n=l(n,o,r,i,t[2],17,606105819),i=l(i,n,o,r,t[3],22,-1044525330);r=l(r,i,n,o,t[4],7,-176418897),o=l(o,r,i,n,t[5],12,1200080426),n=l(n,o,r,i,t[6],17,-1473231341),i=l(i,n,o,r,t[7],22,-45705983),r=l(r,i,n,o,t[8],7,1770035416),o=l(o,r,i,n,t[9],12,-1958414417),n=l(n,o,r,i,t[10],17,-42063),i=l(i,n,o,r,t[11],22,-1990404162),r=l(r,i,n,o,t[12],7,1804603682),o=l(o,r,i,n,t[13],12,-40341101),n=l(n,o,r,i,t[14],17,-1502002290),r=u(r,i=l(i,n,o,r,t[15],22,1236535329),n,o,t[1],5,-165796510),o=u(o,r,i,n,t[6],9,-1069501632),n=u(n,o,r,i,t[11],14,643717713),i=u(i,n,o,r,t[0],20,-373897302),r=u(r,i,n,o,t[5],5,-701558691),o=u(o,r,i,n,t[10],9,38016083),n=u(n,o,r,i,t[15],14,-660478335),i=u(i,n,o,r,t[4],20,-405537848),r=u(r,i,n,o,t[9],5,568446438),o=u(o,r,i,n,t[14],9,-1019803690),n=u(n,o,r,i,t[3],14,-187363961),i=u(i,n,o,r,t[8],20,1163531501),r=u(r,i,n,o,t[13],5,-1444681467),o=u(o,r,i,n,t[2],9,-51403784),n=u(n,o,r,i,t[7],14,1735328473),r=p(r,i=u(i,n,o,r,t[12],20,-1926607734),n,o,t[5],4,-378558),o=p(o,r,i,n,t[8],11,-2022574463),n=p(n,o,r,i,t[11],16,1839030562),i=p(i,n,o,r,t[14],23,-35309556),r=p(r,i,n,o,t[1],4,-1530992060),o=p(o,r,i,n,t[4],11,1272893353),n=p(n,o,r,i,t[7],16,-155497632),i=p(i,n,o,r,t[10],23,-1094730640),r=p(r,i,n,o,t[13],4,681279174),o=p(o,r,i,n,t[0],11,-358537222),n=p(n,o,r,i,t[3],16,-722521979),i=p(i,n,o,r,t[6],23,76029189),r=p(r,i,n,o,t[9],4,-640364487),o=p(o,r,i,n,t[12],11,-421815835),n=p(n,o,r,i,t[15],16,530742520),r=d(r,i=p(i,n,o,r,t[2],23,-995338651),n,o,t[0],6,-198630844),o=d(o,r,i,n,t[7],10,1126891415),n=d(n,o,r,i,t[14],15,-1416354905),i=d(i,n,o,r,t[5],21,-57434055),r=d(r,i,n,o,t[12],6,1700485571),o=d(o,r,i,n,t[3],10,-1894986606),n=d(n,o,r,i,t[10],15,-1051523),i=d(i,n,o,r,t[1],21,-2054922799),r=d(r,i,n,o,t[8],6,1873313359),o=d(o,r,i,n,t[15],10,-30611744),n=d(n,o,r,i,t[6],15,-1560198380),i=d(i,n,o,r,t[13],21,1309151649),r=d(r,i,n,o,t[4],6,-145523070),o=d(o,r,i,n,t[11],10,-1120210379),n=d(n,o,r,i,t[2],15,718787259),i=d(i,n,o,r,t[9],21,-343485551),e[0]=a(r,e[0]),e[1]=a(i,e[1]),e[2]=a(n,e[2]),e[3]=a(o,e[3])}function f(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return t}function h(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24);return t}function r(e){for(var t,r,o,n,i=e.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=i;s+=64)c(a,f(e.substring(s-64,s)));for(t=(e=e.substring(s-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<t;s+=1)r[s>>2]|=e.charCodeAt(s)<<(s%4<<3);if(r[s>>2]|=128<<(s%4<<3),55<s)for(c(a,r),s=0;s<16;s+=1)r[s]=0;return n=(n=8*i).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),n=parseInt(n[1],16)||0,r[14]=o,r[15]=n,c(a,r),a}function m(e){for(var t=0;t<e.length;t+=1)e[t]=function(e){for(var t="",r=0;r<4;r+=1)t+=o[e>>8*r+4&15]+o[e>>8*r&15];return t}(e[t]);return e.join("")}function i(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}function g(e){return e=/[\u0080-\uFFFF]/.test(e)?unescape(encodeURIComponent(e)):e}function y(e){for(var t=[],r=e.length,o=0;o<r-1;o+=2)t.push(parseInt(e.substr(o,2),16));return String.fromCharCode.apply(String,t)}function v(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==m(r("hello"))&&(a=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var r=this.byteLength,e=i(e,r),o=r;return(o=t!==n?i(t,r):o)<e?new ArrayBuffer(0):(t=o-e,r=new ArrayBuffer(t),o=new Uint8Array(r),e=new Uint8Array(this,e,t),o.set(e),r)}),v.prototype.append=function(e){return this.appendBinary(g(e)),this},v.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;for(var t=this._buff.length,r=64;r<=t;r+=64)c(this._hash,f(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},v.prototype.end=function(e){for(var t,r=this._buff,o=r.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<o;i+=1)n[i>>2]|=r.charCodeAt(i)<<(i%4<<3);return this._finish(n,o),t=m(this._hash),e&&(t=y(t)),this.reset(),t},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},v.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(e,t){var r,o=t;if(e[o>>2]|=128<<(o%4<<3),55<o)for(c(this._hash,e),o=0;o<16;o+=1)e[o]=0;t=(t=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(t[2],16),t=parseInt(t[1],16)||0,e[14]=r,e[15]=t,c(this._hash,e)},v.hash=function(e,t){return v.hashBinary(g(e),t)},v.hashBinary=function(e,t){e=m(r(e));return t?y(e):e},(v.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){r=this._buff.buffer,o=e,n=!0,(i=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),i.set(new Uint8Array(o),r.byteLength);var t,r,o,n,i,a=n?i:i.buffer,s=a.length;for(this._length+=e.byteLength,t=64;t<=s;t+=64)c(this._hash,h(a.subarray(t-64,t)));return this._buff=t-64<s?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(e){for(var t,r=this._buff,o=r.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<o;i+=1)n[i>>2]|=r[i]<<(i%4<<3);return this._finish(n,o),t=m(this._hash),e&&(t=y(t)),this.reset(),t},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var e,t=v.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},v.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){for(var r=e.length,o=new ArrayBuffer(r),n=new Uint8Array(o),i=0;i<r;i+=1)n[i]=e.charCodeAt(i);return t?n:o}(e.buff,!0),v.prototype.setState.call(this,e)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(e,t){e=m(function(e){for(var t,r,o,n,i=e.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=i;s+=64)c(a,h(e.subarray(s-64,s)));for(t=(e=s-64<i?e.subarray(s-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<t;s+=1)r[s>>2]|=e[s]<<(s%4<<3);if(r[s>>2]|=128<<(s%4<<3),55<s)for(c(a,r),s=0;s<16;s+=1)r[s]=0;return n=(n=8*i).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),n=parseInt(n[1],16)||0,r[14]=o,r[15]=n,c(a,r),a}(new Uint8Array(e)));return t?y(e):e},v}var n;if("object"===_typeof(r))t.exports=o();else{try{n=window}catch(e){n=self}n.SparkMD5=o()}},{}],2:[function(e,t,r){var o,e=e("./browser-md5-file");"object"===("undefined"==typeof window?"undefined":(o=window)&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":_typeof(o))&&(window.browserMD5File=e)},{"./browser-md5-file":3}],3:[function(e,t,r){var p=e("spark-md5");t.exports=function(r,t){var o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,n=2097152,i=Math.ceil(r.size/n),a=0,s=new p.ArrayBuffer,l=new FileReader;function u(){var e=a*n,t=e+n>=r.size?r.size:e+n;l.readAsArrayBuffer(o.call(r,e,t))}u(),l.onloadend=function(e){s.append(e.target.result),++a<i?u():t(null,s.end())},l.onerror=function(){t("oops, something went wrong.")}}},{"spark-md5":1}]},{},[2]);var base64js_min=createCommonjsModule(function(e,t){e.exports=function o(n,i,a){function s(t,e){if(!i[t]){if(!n[t]){var r="function"==typeof commonjsRequire&&commonjsRequire;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=i[t]={exports:{}},n[t][0].call(r.exports,function(e){return s(n[t][1][e]||e)},r,r.exports,o,n,i,a)}return i[t].exports}for(var l="function"==typeof commonjsRequire&&commonjsRequire,e=0;e<a.length;e++)s(a[e]);return s}({"/":[function(e,t,r){r.byteLength=function(e){var e=p(e),t=e[0],e=e[1];return 3*(t+e)/4-e},r.toByteArray=function(e){for(var t,r=p(e),o=r[0],r=r[1],n=new u(function(e,t){return 3*(e+t)/4-t}(o,r)),i=0,a=0<r?o-4:o,s=0;s<a;s+=4)t=l[e.charCodeAt(s)]<<18|l[e.charCodeAt(s+1)]<<12|l[e.charCodeAt(s+2)]<<6|l[e.charCodeAt(s+3)],n[i++]=t>>16&255,n[i++]=t>>8&255,n[i++]=255&t;2===r&&(t=l[e.charCodeAt(s)]<<2|l[e.charCodeAt(s+1)]>>4,n[i++]=255&t);1===r&&(t=l[e.charCodeAt(s)]<<10|l[e.charCodeAt(s+1)]<<4|l[e.charCodeAt(s+2)]>>2,n[i++]=t>>8&255,n[i++]=255&t);return n},r.fromByteArray=function(e){for(var t,r=e.length,o=r%3,n=[],i=0,a=r-o;i<a;i+=16383)n.push(function(e,t,r){for(var o,n=[],i=t;i<r;i+=3)o=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),n.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(o));return n.join("")}(e,i,a<i+16383?a:i+16383));1==o?(t=e[r-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2==o&&(t=(e[r-2]<<8)+e[r-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return n.join("")};for(var s=[],l=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,i=o.length;n<i;++n)s[n]=o[n],l[o.charCodeAt(n)]=n;function p(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}]},{},[])("/")}),md5_min=createCommonjsModule(function(module){!function(){function t(e){e?(d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d,this.buffer8=l):a?(e=new ArrayBuffer(68),this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="input is invalid type",e="object"==("undefined"==typeof window?"undefined":_typeof(window)),i=e?window:{},s=(i.JS_MD5_NO_WINDOW&&(e=!1),!e&&"object"==("undefined"==typeof self?"undefined":_typeof(self))),h=!i.JS_MD5_NO_NODE_JS&&"object"==("undefined"==typeof process?"undefined":_typeof(process))&&process.versions&&process.versions.node,f=(h?i=commonjsGlobal:s&&(i=self),!i.JS_MD5_NO_COMMON_JS&&module.exports),o=!1,a=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,n="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],y=[0,8,16,24],c=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[],l,A,l,d,b=(a&&(A=new ArrayBuffer(68),l=new Uint8Array(A),d=new Uint32Array(A)),!i.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!a||!i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==_typeof(e)&&e.buffer&&e.buffer.constructor===ArrayBuffer}),function(r){return function(e){return new t(!0).update(e)[r]()}}),v=function(){var r=b("hex");(r=h?w(r):r).create=function(){return new t},r.update=function(e){return r.create().update(e)};for(var e=0;e<c.length;++e){var o=c[e];r[o]=b(o)}return r},w=function w(t){var e=eval("require('crypto')"),i=eval("require('buffer').Buffer"),s=function(o){if("string"==typeof o)return e.createHash("md5").update(o,"utf8").digest("hex");if(null==o)throw r;return o.constructor===ArrayBuffer&&(o=new Uint8Array(o)),Array.isArray(o)||ArrayBuffer.isView(o)||o.constructor===i?e.createHash("md5").update(new i(o)).digest("hex"):t(o)};return s},_=(t.prototype.update=function(e){if(!this.finalized){var t,o=_typeof(e);if("string"!==o){if("object"!==o)throw r;if(null===e)throw r;if(a&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||a&&ArrayBuffer.isView(e)))throw r;t=!0}for(var n,i,s=0,l=e.length,u=this.blocks,p=this.buffer8;s<l;){if(this.hashed&&(this.hashed=!1,u[0]=u[16],u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),t)if(a)for(i=this.start;s<l&&i<64;++s)p[i++]=e[s];else for(i=this.start;s<l&&i<64;++s)u[i>>2]|=e[s]<<y[3&i++];else if(a)for(i=this.start;s<l&&i<64;++s)(n=e.charCodeAt(s))<128?p[i++]=n:(n<2048?p[i++]=192|n>>6:(n<55296||57344<=n?p[i++]=224|n>>12:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),p[i++]=240|n>>18,p[i++]=128|n>>12&63),p[i++]=128|n>>6&63),p[i++]=128|63&n);else for(i=this.start;s<l&&i<64;++s)(n=e.charCodeAt(s))<128?u[i>>2]|=n<<y[3&i++]:(n<2048?u[i>>2]|=(192|n>>6)<<y[3&i++]:(n<55296||57344<=n?u[i>>2]|=(224|n>>12)<<y[3&i++]:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),u[i>>2]|=(240|n>>18)<<y[3&i++],u[i>>2]|=(128|n>>12&63)<<y[3&i++]),u[i>>2]|=(128|n>>6&63)<<y[3&i++]),u[i>>2]|=(128|63&n)<<y[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,64<=i?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},t.prototype.finalize=function(){var e,t;this.finalized||(this.finalized=!0,(e=this.blocks)[(t=this.lastByteIndex)>>2]|=u[3&t],56<=t&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash())},t.prototype.hash=function(){var e,t,r,o,n,i=this.blocks,a=this.first?((a=((e=((e=i[0]-680876937)<<7|e>>>25)-271733879<<0)^(t=((t=(-271733879^(r=((r=(-1732584194^2004318071&e)+i[1]-117830708)<<12|r>>>20)+e<<0)&(-271733879^e))+i[2]-1126478375)<<17|t>>>15)+r<<0)&(r^e))+i[3]-1316259209)<<22|a>>>10)+t<<0:(e=this.h0,a=this.h1,t=this.h2,((a+=((e=((e+=((r=this.h3)^a&(t^r))+i[0]-680876936)<<7|e>>>25)+a<<0)^(t=((t+=(a^(r=((r+=(t^e&(a^t))+i[1]-389564586)<<12|r>>>20)+e<<0)&(e^a))+i[2]+606105819)<<17|t>>>15)+r<<0)&(r^e))+i[3]-1044525330)<<22|a>>>10)+t<<0);a=((a+=((e=((e+=(r^a&(t^r))+i[4]-176418897)<<7|e>>>25)+a<<0)^(t=((t+=(a^(r=((r+=(t^e&(a^t))+i[5]+1200080426)<<12|r>>>20)+e<<0)&(e^a))+i[6]-1473231341)<<17|t>>>15)+r<<0)&(r^e))+i[7]-45705983)<<22|a>>>10)+t<<0,a=((a+=((e=((e+=(r^a&(t^r))+i[8]+1770035416)<<7|e>>>25)+a<<0)^(t=((t+=(a^(r=((r+=(t^e&(a^t))+i[9]-1958414417)<<12|r>>>20)+e<<0)&(e^a))+i[10]-42063)<<17|t>>>15)+r<<0)&(r^e))+i[11]-1990404162)<<22|a>>>10)+t<<0,a=((a+=((e=((e+=(r^a&(t^r))+i[12]+1804603682)<<7|e>>>25)+a<<0)^(t=((t+=(a^(r=((r+=(t^e&(a^t))+i[13]-40341101)<<12|r>>>20)+e<<0)&(e^a))+i[14]-1502002290)<<17|t>>>15)+r<<0)&(r^e))+i[15]+1236535329)<<22|a>>>10)+t<<0,a=((a+=((r=((r+=(a^t&((e=((e+=(t^r&(a^t))+i[1]-165796510)<<5|e>>>27)+a<<0)^a))+i[6]-1069501632)<<9|r>>>23)+e<<0)^e&((t=((t+=(e^a&(r^e))+i[11]+643717713)<<14|t>>>18)+r<<0)^r))+i[0]-373897302)<<20|a>>>12)+t<<0,a=((a+=((r=((r+=(a^t&((e=((e+=(t^r&(a^t))+i[5]-701558691)<<5|e>>>27)+a<<0)^a))+i[10]+38016083)<<9|r>>>23)+e<<0)^e&((t=((t+=(e^a&(r^e))+i[15]-660478335)<<14|t>>>18)+r<<0)^r))+i[4]-405537848)<<20|a>>>12)+t<<0,a=((a+=((r=((r+=(a^t&((e=((e+=(t^r&(a^t))+i[9]+568446438)<<5|e>>>27)+a<<0)^a))+i[14]-1019803690)<<9|r>>>23)+e<<0)^e&((t=((t+=(e^a&(r^e))+i[3]-187363961)<<14|t>>>18)+r<<0)^r))+i[8]+1163531501)<<20|a>>>12)+t<<0,a=((a+=((r=((r+=(a^t&((e=((e+=(t^r&(a^t))+i[13]-1444681467)<<5|e>>>27)+a<<0)^a))+i[2]-51403784)<<9|r>>>23)+e<<0)^e&((t=((t+=(e^a&(r^e))+i[7]+1735328473)<<14|t>>>18)+r<<0)^r))+i[12]-1926607734)<<20|a>>>12)+t<<0,a=((a+=((n=(r=((r+=((o=a^t)^(e=((e+=(o^r)+i[5]-378558)<<4|e>>>28)+a<<0))+i[8]-2022574463)<<11|r>>>21)+e<<0)^e)^(t=((t+=(n^a)+i[11]+1839030562)<<16|t>>>16)+r<<0))+i[14]-35309556)<<23|a>>>9)+t<<0,a=((a+=((n=(r=((r+=((o=a^t)^(e=((e+=(o^r)+i[1]-1530992060)<<4|e>>>28)+a<<0))+i[4]+1272893353)<<11|r>>>21)+e<<0)^e)^(t=((t+=(n^a)+i[7]-155497632)<<16|t>>>16)+r<<0))+i[10]-1094730640)<<23|a>>>9)+t<<0,a=((a+=((n=(r=((r+=((o=a^t)^(e=((e+=(o^r)+i[13]+681279174)<<4|e>>>28)+a<<0))+i[0]-358537222)<<11|r>>>21)+e<<0)^e)^(t=((t+=(n^a)+i[3]-722521979)<<16|t>>>16)+r<<0))+i[6]+76029189)<<23|a>>>9)+t<<0,a=((a+=((n=(r=((r+=((o=a^t)^(e=((e+=(o^r)+i[9]-640364487)<<4|e>>>28)+a<<0))+i[12]-421815835)<<11|r>>>21)+e<<0)^e)^(t=((t+=(n^a)+i[15]+530742520)<<16|t>>>16)+r<<0))+i[2]-995338651)<<23|a>>>9)+t<<0,a=((a+=((r=((r+=(a^((e=((e+=(t^(a|~r))+i[0]-198630844)<<6|e>>>26)+a<<0)|~t))+i[7]+1126891415)<<10|r>>>22)+e<<0)^((t=((t+=(e^(r|~a))+i[14]-1416354905)<<15|t>>>17)+r<<0)|~e))+i[5]-57434055)<<21|a>>>11)+t<<0,a=((a+=((r=((r+=(a^((e=((e+=(t^(a|~r))+i[12]+1700485571)<<6|e>>>26)+a<<0)|~t))+i[3]-1894986606)<<10|r>>>22)+e<<0)^((t=((t+=(e^(r|~a))+i[10]-1051523)<<15|t>>>17)+r<<0)|~e))+i[1]-2054922799)<<21|a>>>11)+t<<0,a=((a+=((r=((r+=(a^((e=((e+=(t^(a|~r))+i[8]+1873313359)<<6|e>>>26)+a<<0)|~t))+i[15]-30611744)<<10|r>>>22)+e<<0)^((t=((t+=(e^(r|~a))+i[6]-1560198380)<<15|t>>>17)+r<<0)|~e))+i[13]+1309151649)<<21|a>>>11)+t<<0,a=((a+=((r=((r+=(a^((e=((e+=(t^(a|~r))+i[4]-145523070)<<6|e>>>26)+a<<0)|~t))+i[11]-1120210379)<<10|r>>>22)+e<<0)^((t=((t+=(e^(r|~a))+i[2]+718787259)<<15|t>>>17)+r<<0)|~e))+i[9]-343485551)<<21|a>>>11)+t<<0,this.first?(this.h0=e+1732584193<<0,this.h1=a-271733879<<0,this.h2=t-1732584194<<0,this.h3=r+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+a<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0)},t.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3;return n[e>>4&15]+n[15&e]+n[e>>12&15]+n[e>>8&15]+n[e>>20&15]+n[e>>16&15]+n[e>>28&15]+n[e>>24&15]+n[t>>4&15]+n[15&t]+n[t>>12&15]+n[t>>8&15]+n[t>>20&15]+n[t>>16&15]+n[t>>28&15]+n[t>>24&15]+n[r>>4&15]+n[15&r]+n[r>>12&15]+n[r>>8&15]+n[r>>20&15]+n[r>>16&15]+n[r>>28&15]+n[r>>24&15]+n[o>>4&15]+n[15&o]+n[o>>12&15]+n[o>>8&15]+n[o>>20&15]+n[o>>16&15]+n[o>>28&15]+n[o>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.base64=function(){for(var e,t,r,o="",n=this.array(),i=0;i<15;)e=n[i++],t=n[i++],r=n[i++],o+=p[e>>>2]+p[63&(e<<4|t>>>4)]+p[63&(t<<2|r>>>6)]+p[63&r];return e=n[i],o+(p[e>>>2]+p[e<<4&63]+"==")},v());f?module.exports=_:i.md5=_}()});function Utils(){}function Str2Bytes(e){var t=0,r=e.length;if(r%2!=0)return null;r/=2;for(var o=new Array,n=0;n<r;n++){var i=e.substr(t,2),i=parseInt(i,16);o.push(i),t+=2}return o}function Service(e){this.projectId=(e=e||{}).project_id,this.ak=e.ak,this.sk=e.sk,this.security_token=e.security_token,this.vodServer=e.vod_server||"vod.cn-north-1.myhuaweicloud.com",this.vodPort=e.vod_port||"",this.baseUrl=this.vodServer+(this.vodPort?":":"")+this.vodPort}function syncServerTime(e){var e=Date.parse(e),t=Date.now()-e;return sessionStorage&&3e5<Math.abs(t)&&(sessionStorage.setItem("time-deviation",t),setTimeout(function(){sessionStorage.removeItem("time-deviation")},6e4),console.log("your local system time has big gap with server time,please check it！ time difference:"+t)),e}function ReportService(){}function NetworkStat(){var t=this,e=navigator.connection;e&&(this.networkType=e.type,Object.prototype.hasOwnProperty.call(navigator.connection,"onchange"))&&(navigator.connection.onchange=function(){var e=navigator.connection;t.networkType=e.type})}function ReportManage(){this.ReportService=null,this.ReportService||(this.ReportService=new ReportService)}Utils.prototype.vodAuthModel={access_key_id:{required:!0,location:"vodClient"},secret_access_key:{required:!0,location:"vodClient"},security_token:{required:!0,location:"vodClient"},project_id:{required:!0,location:"vodClient"},vod_server:{required:!0,location:"vodClient"}},Utils.prototype.vodAssetModel={videoFile:{required:!0,location:"param"},bucket:{required:!1,location:"param"},object:{required:!1,location:"param"},asset_id:{required:!1,location:"param"}},Utils.prototype.crypto_=window.crypto||window.webkitCrypto||window.mozCrypto||window.oCrypto||window.msCrypto,Utils.prototype.utilFunctions={getCoverMD5:function(e){return e?new Promise(function(r){md5Service.genMd5(e,function(e,t){r(t)})}):new Promise(function(e){e("")})},resolveXML:function(e,t){e=e.getElementsByTagName("InitiateMultipartUploadResult");return{Bucket:e[0].getElementsByTagName("Bucket")[0].firstChild.nodeValue,Key:e[0].getElementsByTagName("Key")[0].firstChild.nodeValue,UploadId:e[0].getElementsByTagName("UploadId")[0].firstChild.nodeValue}},createXmlDOC:function(e,t){var r=null;try{r=new ActiveXObject("Microsoft.XMLDOM")}catch(e){r=document.implementation.createDocument("","",null)}var o=r.createElement("CompleteMultipartUpload");r.appendChild(o);for(var n=0;n<t;n++){var i,a=n+1,s=r.createElement("Part"),l=r.createElement("PartNumber"),u=r.createElement("ETag");s.appendChild(l),s.appendChild(u),a=r.createTextNode(a),i=r.createTextNode(e[n]),l.appendChild(a),u.appendChild(i),r.documentElement.appendChild(s)}return r}},Utils.prototype.genMd5=function(e,r){window.browserMD5File(e,function(e,t){t=base64js_min.fromByteArray(Str2Bytes(t));r(e,t)})},Utils.prototype.computeFirstKBMd5=function(e,t,r){try{var o,n=new FileReader,i=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;n.readAsArrayBuffer(i.call(e,0,1025)),n.onload=function(e){o=md5_min(e.target.result),console.log("computeFirstKBMd5:"+o),t(o)},n.onerror=r}catch(e){r(e)}},Utils.prototype.checkParam=function(e,t){e=e||{};var r,o={};for(r in t){if("required"in t[r]&&!(r in e))return o.err=r+" is a required element!",o;r in e&&!e[r]&&(o.err=r+" is Not allowed to be empty")}return o},Utils.prototype.assetInfo=function(e){return{index:e.index,bucket:e.bucket,object:e.object,file:e.videoFile,upFlag:e.upFlag,progress:e.progress,asset_id:e.asset_id}},Utils.prototype.getDeviceID=function(e){return this.deviceID||(this.deviceID=this.generateStandardUuid()),this.deviceID},Utils.prototype.generateStandardUuid=function(e){var t,r,o=this;return(t=this.crypto_?"function"==typeof this.crypto_.randomUUID?this.crypto_.randomUUID():"":t)||(r=(new Date).getTime(),window.performance&&"function"==typeof window.performance.now&&(r+=performance.now()),t="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,function(){var e=(r+16*o.getRandom())%16|0;return r=Math.floor(r/16),e.toString(16)})),t},Utils.prototype.getRandom=function(){return this.getRandomArray(1)[0]/256},Utils.prototype.getRandomArray=function(e){e=new Uint8Array(e);return this.crypto_&&this.crypto_.getRandomValues(e),e},Utils.isEmpty=function(e){return null==e||""===e},Utils.anonymous=function(e){if(0===e.length)t="";else if(1<e.length)for(var t=e.substring(0,e.length/2),r=0;r<e.length-e.length/2;r++)t+="*";else t="*";return t},Service.prototype.getServerTime=function(){var o=null;return sessionStorage&&null!=sessionStorage.getItem("time-deviation")?o=Date.now()-sessionStorage.getItem("time-deviation"):($.ajax({url:"https://"+this.baseUrl+"/v1.0/"+this.projectId+"/asset/authority",type:"OPTIONS",processData:!1,timeout:5e3,async:!1,success:function(e,t,r){r=r.getResponseHeader("Date");if(null===r)return Date.now();o=syncServerTime(r)},error:function(e){if(200===e.status){e=e.getResponseHeader("Date");if(null===e)return Date.now();o=syncServerTime(e)}}}),sessionStorage&&null===sessionStorage.getItem("time-deviation")&&(sessionStorage.setItem("time-deviation","0"),setTimeout(function(){sessionStorage.removeItem("time-deviation")},6e5))),o},Service.prototype.createAsset=function(e){var t=e.videoFile.name.split("."),t=t[t.length-1],r=this.getServerTime(),e={title:e.videoFile.name,video_name:e.videoFile.name,video_type:t.toUpperCase(),subtitles:[]};return this.signAjax({scheme:"https",method:"POST",host:this.vodServer,uri:"/v1.0/"+this.projectId+"/asset",timeout:6e4,headers:{"x-project-id":this.projectId,"Content-Type":"application/json"},body:JSON.stringify(e),serverTime:r})},Service.prototype.confirmAsset=function(e){var t=this.getServerTime(),e={asset_id:e.asset_id,status:"CREATED"};return this.signAjax({scheme:"https",method:"POST",host:this.vodServer,uri:"/v1.0/"+this.projectId+"/asset/status/uploaded",timeout:6e4,headers:{"x-project-id":this.projectId,"Content-Type":"application/json"},body:JSON.stringify(e),serverTime:t})},Service.prototype.signAjax=function(e){var t=new signer.HttpRequest;t.method=e.method,t.host=e.host&&e.host.trim(),t.uri=e.uri&&e.uri.trim();try{t.query="object"===_typeof(e.query)?e.query:JSON.parse(e.query)}catch(e){t.query={}}try{t.headers="object"===_typeof(e.headers)?e.headers:JSON.parse(e.headers)}catch(e){t.headers={}}t.body=e.body;var r=new signer.Signer,r=(r.Key=this.ak,r.Secret=this.sk,e.serverTime&&(t.serverTime=e.serverTime),r.Sign(t));return r.headers["X-Security-Token"]=this.security_token,delete r.headers.host,$.ajax({url:e.scheme+"://"+r.hostname+r.path,type:r.method,data:e.body,headers:r.headers,processData:!1,timeout:e.timeout||5e3})},Service.prototype.getAuthorization=function(e){e=e||{};var t=this.getServerTime();return this.signAjax({scheme:"https",method:"GET",host:this.baseUrl,uri:"/v1.0/"+this.projectId+"/asset/authority",timeout:6e4,query:e,headers:{"x-project-id":this.projectId},serverTime:t})},Service.prototype.InitializationUploadPart=function(e){return e=e||{},$.ajax({type:"POST",url:"https://"+e.bucket+".obs."+this.vodServer.substring(4)+"/"+encodeURI(e.object_key)+"?uploads&"+e.sign_str,timeout:6e5,beforeSend:function(e,t){e.setRequestHeader("Content-Type","video/mp4")}})},Service.prototype.uploadPart=function(r,o){return r=r||{},$.ajax({type:"PUT",url:"https://"+r.bucket+".obs."+this.vodServer.substring(4)+"/"+encodeURI(r.object_key)+"?partNumber="+r.part_number+"&uploadId="+r.upload_id+"&"+r.sign_str,timeout:3e5,beforeSend:function(e,t){e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("Content-MD5",r.content_md5),t.data=o.file}})},Service.prototype.completeMultipartUpload=function(e,r){return e=e||{},$.ajax({type:"POST",url:"https://"+e.bucket+".obs."+this.vodServer.substring(4)+"/"+encodeURI(e.object_key)+"?"+e.sign_str+"&uploadId="+e.upload_id,beforeSend:function(e,t){e.setRequestHeader("Content-Type","application/xml"),t.data=r.xmlDoc},timeout:6e5,data:e})},Service.prototype.uploadCoverFile=function(r){return r=r||{},$.ajax({type:"PUT",url:"https://"+r.bucket+".obs."+this.vodServer.substring(4)+"/"+encodeURI(r.object_key)+"?partNumber="+r.part_number+"&uploadId="+r.upload_id+"&"+r.sign_str,timeout:6e5,beforeSend:function(e,t){e.setRequestHeader("Content-Type",r.coverType),e.setRequestHeader("Content-MD5",r.coverMd5),t.data=r.coverFile}})},Service.prototype.uploadsubtitleFile=function(r){return r=r||{},$.ajax({type:"PUT",url:"https://"+r.bucket+".obs."+this.vodServer.substring(4)+"/"+encodeURI(r.object_key)+"?partNumber="+r.part_number+"&uploadId="+r.upload_id+"&"+r.sign_str,timeout:6e5,beforeSend:function(e,t){e.setRequestHeader("Content-Type",r.subtitleType),e.setRequestHeader("Content-MD5",r.subtitleMd5),t.data=r.subtitleFile}})},Service.prototype.checkVodDuplication=function(e,t){return this.signAjax({scheme:"https",method:"GET",host:this.baseUrl,uri:"/v1.0/"+this.projectId+"/asset/duplication",query:{md5:e,size:t},headers:{"x-project-id":this.projectId},timeout:6e4})},ReportService.prototype.reportAjax=function(e,t){var r=Math.floor((new Date).getTime()/1e3);return $.ajax({url:"https://log-collection-new.hwcloudlive.com/v2/log_common/log_report",type:"POST",data:JSON.stringify({RequestId:e,Timestamp:r,Logs:[t]}),headers:{"X-App-Id":"0931c04d-df0c-4b5e-a230-661bc2a7e57c",Timestamp:r,"Content-Type":"application/json"},processData:!1,timeout:5e3})},NetworkStat.prototype={constructor:NetworkStat,getNetworkType:function(){return Utils.isEmpty(this.networkType)?"":this.networkType}},ReportManage.prototype.init=function(e,t){this.version=e.version,this.utils=t,this.deviceId=t.getDeviceID(),this.endPoint=e.endPoint,this.initializationInfo=new Map,this.partUploadInfo=new Map,this.completeInfo=new Map,this.confirmInfo=new Map,this.networkStat=new NetworkStat},ReportManage.prototype.reportApiCall=function(e){var t=this.genarateHead({event:501,eventName:"APICallEvent"}),e={apiName:e.apiName||"",params:JSON.stringify(e.params)||"{}",startTime:e.startTime||0,endTime:(new Date).getTime()||0,exception:e.exception||"",ret:e.ret||""},t=_objectSpread2(_objectSpread2({},t),e);return this.ReportService.reportAjax(this.utils.generateStandardUuid(),t)},ReportManage.prototype.reportUploadResult=function(e){var t=this.genarateHead({event:201,eventName:"UploadResultEvent"}),r=this.initializationInfo.get(e),o=this.partUploadInfo.get(e),n=this.completeInfo.get(e),i={assetId:r?r.assetId:"",upload_id:e||"",partSize:r?r.partSize:0,endPoint:this.endPoint||"",result:n?n.result:1,contentType:r?r.videoType:"",uploadedSize:r&&o?o.uploadedPercentage*r.fileSize/100:0,totalSize:r?r.fileSize:0,startTime:r?r.startTime:0,endTime:n?n.endTime:o?o.endTime:r?r.endTime:0,uploadFlow:[]},r=(Utils.isEmpty(this.createInfo)||(i.uploadFlow[0]={id:0,action:"create",start_ms:this.createInfo.startTime||0,end_ms:this.createInfo.endTime||0,errCode:this.createInfo.errCode||0,errMsg:JSON.stringify(this.createInfo.errMsg)||""}),r&&(Utils.isEmpty(r.createInfo)||(i.uploadFlow[0]={id:0,action:"create",start_ms:r.createInfo.startTime||0,end_ms:r.createInfo.endTime||0,errCode:0,errMsg:""}),i.uploadFlow[1]={id:1,action:"initUpload",start_ms:r.startTime||0,end_ms:r.endTime||0,errCode:r.errCode||0,errMsg:JSON.stringify(r.errMsg)||""}),o&&(i.uploadFlow[2]={id:2,action:"partUpload",start_ms:r.endTime||0,end_ms:o.endTime||0,errCode:o.errCode||0,errMsg:JSON.stringify(o.errMsg)||""}),!1),n=(n&&(r=n.internalManageAsset,i.uploadFlow[3]={id:3,action:"CompleteMultipartUpload",start_ms:o.endTime||0,end_ms:n.endTime||0,errCode:n.errCode||0,errMsg:JSON.stringify(n.errMsg)||""}),r&&(o=this.confirmInfo.get(e))&&(i.result=o.result,i.uploadFlow[4]={id:4,action:"confirm",start_ms:o.endTime||0,end_ms:o.endTime||0,errCode:o.errCode||0,errMsg:JSON.stringify(o.errMsg)||""}),_objectSpread2(_objectSpread2({},t),i));return this.ReportService.reportAjax(this.utils.generateStandardUuid(),n)},ReportManage.prototype.reportCreateErrorInfo=function(e){this.createInfo=e,this.reportUploadResult(""),this.createInfo={}},ReportManage.prototype.setInitializationInfo=function(e,t){this.initializationInfo.set(e.uploadId,e),t&&this.reportUploadResult(e.uploadId)},ReportManage.prototype.setPartUploadInfo=function(e,t){this.partUploadInfo.set(e.uploadId,e),t&&this.reportUploadResult(e.uploadId)},ReportManage.prototype.setCompleteInfo=function(e){this.completeInfo.set(e.uploadId,e),e.internalManageAsset||(this.reportUploadResult(e.uploadId),this.delUploadResultInfos(e.uploadId))},ReportManage.prototype.setConfirmInfo=function(e){this.confirmInfo.set(e.uploadId,e),this.reportUploadResult(e.uploadId),this.delUploadResultInfos(e.uploadId)},ReportManage.prototype.delUploadResultInfos=function(e){this.initializationInfo.has(e)&&this.initializationInfo.delete(e),this.partUploadInfo.has(e)&&this.partUploadInfo.delete(e),this.completeInfo.has(e)&&this.completeInfo.delete(e),this.confirmInfo.has(e)&&this.confirmInfo.delete(e)},ReportManage.prototype.genarateHead=function(e){return{ctime:(new Date).toISOString()||"",deviceId:this.deviceId||"",v:this.version||"",event:e.event||"",eventName:e.eventName||"",netType:this.networkStat.getNetworkType()||"",userAgent:navigator.userAgent||""}};var configs={SDK_VERSION:"1.0.0.300",COMMIT_ID:"39d64e7"};function callbackMsg(e,t,r){return{code:e||0,data:t||{},msg:r||""}}function VodClientImpl(e){this.options=e||{};this.onUploadTokenExpired=this.options.onUploadTokenExpired,this.onUploadstarted=this.options.onUploadstarted,this.onUploadProgress=this.options.onUploadProgress,this.onUploadSucceed=this.options.onUploadSucceed,this.onUploadFailed=this.options.onUploadFailed,this.retryCount=0,this.partSize=this.options.partSize?1048576*this.options.partSize:1048576,this.service=null,this.reportManage=null,this.utils=null,this.initAssetList([]),this.factory(this.options)}function VodClient(e){var t=(new Date).getTime();this.vodClintImpl=new VodClientImpl(e);e.access_key_id=Utils.anonymous(e.access_key_id),e.secret_access_key=Utils.anonymous(e.secret_access_key),e.security_token=Utils.anonymous(e.security_token),this.vodClintImpl.reportApiCall({apiName:"API^web#VodClient$VodClient#APP^SDK",params:{options:e},startTime:t,exception:"",ret:""}).then(function(){},function(e){console.log("err"+e)})}VodClientImpl.prototype=function(){var m,r=null;return{constructor:VodClientImpl,initAssetList:function(e){m=e},factory:function(e){this.utils||(this.utils=new Utils);var t=this.utils.checkParam(e,this.utils.vodAuthModel);if("err"in t)throw TypeError("vodClient err："+t.err);this.reportManage||(this.reportManage=new ReportManage,t={version:"web_"+configs.SDK_VERSION+"_"+configs.COMMIT_ID,endPoint:e.vod_server},this.reportManage.init(t,this.utils)),this.service||(this.service=new Service({ak:e.access_key_id,sk:e.secret_access_key,security_token:e.security_token,project_id:e.project_id,vod_server:e.vod_server,vod_port:e.vod_port}))},addAsset:function(t,r){var o=this,n="",i=0;t.index=m.length,t.upFlag="WAITING",t.uploadedIndexes=[],t.uploadPartParameters=null,t.internalManageAsset=!1,t.partCount=0,t.progress=0,t.retryCount=0,t.uploadFilePublicParam={globalContext:{maxTaskNum:5,currentTaskNum:0,currentTask:[]},uploadedCount:0},sessionStorage&&(sessionStorage.removeItem("time-deviation"),sessionStorage.removeItem("last-expire-time")),t.is_check?o.checkUpload(t,function(e){e.is_duplicated?(t.upFlag="REPEAT",n=callbackMsg(1,e,"media asset id:"+t.asset_id+",file is duplicated!"),o.onUploadFailed&&o.onUploadFailed(o.utils.assetInfo(t),n),i=1):(m.push(t),o.autoRecoverUploading()),r&&r({code:i,msg:n})},function(e){t.upFlag="FAILED";e=callbackMsg(1,e,"error token, check your token!");o.onUploadFailed&&o.onUploadFailed(o.utils.assetInfo(t),e),i=1,r&&r({code:i,msg:e})}):(m.push(t),o.autoRecoverUploading(),r&&r({code:i,msg:n}))},startUpload:function(t){for(var r=(new Date).getTime(),o=(t=t||0,this),n="",i="";t<m.length;t++)if("WAITING"==m[t].upFlag){if(m[t].index=t,m[t].uploadFilePublicParam.uploadedCount=0,m[t].partCount=m[t].videoFile.size%o.partSize==0?m[t].videoFile.size/o.partSize:Math.ceil(m[t].videoFile.size/o.partSize),Utils.isEmpty(m[t].bucket)&&Utils.isEmpty(m[t].object)&&Utils.isEmpty(m[t].asset_id)&&!Utils.isEmpty(m[t].videoFile))o.service.createAsset(m[t]).then(function(e){console.log("create asset file: "+m[t].videoFile.name+" success!"),m[t].upFlag="UPLOADING",m[t].bucket=e.target.bucket,m[t].object=e.target.object,m[t].asset_id=e.asset_id,m[t].internalManageAsset=!0,m[t].createInfo={startTime:r,endTime:(new Date).getTime()},o.onUploadstarted&&o.onUploadstarted(o.utils.assetInfo(m[t])),"UPLOADING"==m[t].upFlag&&o.initializationUpload(m[t])},function(e){console.log("create asset file: "+m[t].videoFile.name+" failed!"),m[t].upFlag="CREATE_FAILED",n=e.status;e=callbackMsg(1,i=e,"create asset failed, videoFile:"+m[t].videoFile.name),o.onUploadFailed&&o.onUploadFailed(o.utils.assetInfo(m[t]),e),e={startTime:r,endTime:(new Date).getTime(),errCode:n,errMsg:i};o.reportManage.reportCreateErrorInfo(e)});else{var e=o.utils.checkParam(m[t],o.utils.vodAssetModel);if("err"in e)throw console.log("startUpload err："+e.err),TypeError("startUpload err："+e.err);m[t].upFlag="UPLOADING",o.onUploadstarted&&o.onUploadstarted(o.utils.assetInfo(m[t])),"UPLOADING"==m[t].upFlag&&o.initializationUpload(m[t])}break}},initializationUpload:function(r){var o=(new Date).getTime(),n=this,i=r.videoFile,a=i.name,s=r.bucket,l=r.object,u=r.index,e={http_verb:"POST",content_type:"video/mp4",bucket:s,object_key:l},e=this.service.getAuthorization(e),p={},d="",c="";function f(e){var t=l.split("."),t=t[t.length-1],t={uploadId:p.UploadId,startTime:o,endTime:(new Date).getTime(),assetId:r.asset_id,videoType:t,authorizationStatus:(m[u].upFlag,!0),partSize:n.partSize,fileSize:i.size,partCount:m[u].partCount,errorCode:d,errorMsg:c};m[u].internalManageAsset&&m[u].createInfo&&(t.createInfo=m[u].createInfo),n.reportManage.setInitializationInfo(t,e)}e.then(function(e){var e={sign_str:e.sign_str.replace(/&amp;/g,"&"),object_key:l,bucket:s},t=n.service.InitializationUploadPart(e);t.then(function(e){var t;console.log(a+" init upload success, assetid: "+r.asset_id),p=n.utils.utilFunctions.resolveXML(e,r),m[u].uploadPartParameters=(e=i,{bucketName:(t=p).Bucket,objectKey:t.Key,uploadId:t.UploadId,file:e,fileSize:e.size,partSize:n.partSize,partCount:m[u].partCount,currentPartIndex:0,parts:[],index:u}),"UPLOADING"==m[u].upFlag&&(n.uploadPart(m[u].uploadPartParameters),n.onUploadProgress)&&n.onUploadProgress(n.utils.assetInfo(m[u])),f(!1)},function(e){d=e.status,c=e,console.error(a+" init upload failed, assetid: "+r.asset_id),200!==e.status&&(n.isAppException(e.status)?(m[u].upFlag="MAJOR_FAILED",e=callbackMsg(1,e,"file name："+a+",init upload failed, pls retry!"),n.onUploadFailed&&n.onUploadFailed(n.utils.assetInfo(m[u]),e)):m[u].upFlag="FAILED",n.resetCurrentTask(u,t)),f(!0)})}).catch(function(e){d=e.status,c=e,console.error(a+" init upload failed, assetid: "+r.asset_id),200!==e.status&&n.uploadFailHandle(n,u,e),f(!0)})},uploadPart:function(n){var i=this;for(console.log("uploadPart begin, file: ".concat(m[n.index].videoFile.name,", current task Number: ").concat(m[n.index].uploadFilePublicParam.globalContext.currentTaskNum,", asset upload status: ").concat(m[n.index].upFlag));n.currentPartIndex<n.partCount&&m[n.index].uploadFilePublicParam.globalContext.currentTaskNum<m[n.index].uploadFilePublicParam.globalContext.maxTaskNum&&"UPLOADING"==m[n.index].upFlag&&!m[n.index].uploadedIndexes[n.currentPartIndex];)!function(){var e=n.currentPartIndex*n.partSize,t=n.currentPartIndex+1===n.partCount?n.fileSize:e+n.partSize,r=n.currentPartIndex+1;n.currentPartIndex++,m[n.index].uploadFilePublicParam.globalContext.currentTaskNum++;var o=(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice).call(n.file,e,t);"UPLOADING"==m[n.index].upFlag&&i.utils.genMd5(o,function(e,t){"UPLOADING"==m[n.index].upFlag&&i.doUploadPart(r,n,o,t)})}()},doUploadPart:function(i,a,s,t){var l=this,r=a.bucketName,u=a.uploadId,p=a.objectKey,e={http_verb:"PUT",content_md5:t,part_number:i,upload_id:u,bucket:r,object_key:p},e=l.service.getAuthorization(e),d="",c="",f=!1;function h(e,t){a.parts.length!==a.partCount&&200===d||(t={uploadId:u,endTime:(new Date).getTime(),authorizationStatus:f,uploadedPercentage:t?100:m[a.index].progress,errorCode:d,errorMsg:c},console.log("doUploadPart end, partUploadInfo: "+t),l.reportManage.setPartUploadInfo(t,e))}e.then(function(e){f=!0,console.log("doUploadPart begin, partNumber: ".concat(i,", totalNumber: ").concat(a.partCount)),m[a.index].retryCount=0;var e={sign_str:e.sign_str.replace(/&amp;/g,"&"),content_md5:t,bucket:r,object_key:p,upload_id:u,part_number:i,partCount:a.partCount,file:s},o=l.service.uploadPart(e,{file:s}),n=m[a.index].uploadFilePublicParam.globalContext.currentTask;n.push(o),o.then(function(e,t,r){var r=r.getResponseHeader("ETag"),r=(-1!=r.indexOf('/"')&&(r=(r=r.split('/"')[1]).substr(0,r.length-1)),console.log("doUploadPart success, file: ".concat(m[a.index].videoFile.name,", partNumber: ").concat(i,", totalNumber: ").concat(a.partCount)),0<m[a.index].uploadFilePublicParam.globalContext.currentTaskNum&&m[a.index].uploadFilePublicParam.globalContext.currentTaskNum--,n.splice(n.indexOf(o),1),!0!==m[a.index].uploadedIndexes[i-1]&&(m[a.index].uploadFilePublicParam.uploadedCount++,a.parts.push({PartNumber:i,ETag:r})),m[a.index].uploadedIndexes[i-1]=!0,100*m[a.index].uploadFilePublicParam.uploadedCount/a.partCount);r=(r=100<=r?99.9:r).toFixed(2),"UPLOADING"==m[a.index].upFlag&&(m[a.index].progress=r),console.log("doUploadPart file: ".concat(m[a.index].videoFile.name,", current upload progress: ").concat(r)),"UPLOADING"==m[a.index].upFlag&&l.onUploadProgress&&l.onUploadProgress(l.utils.assetInfo(m[a.index])),s=null,a.parts.length===a.partCount?(r=a.parts.sort(function(e,t){return e.PartNumber>=t.PartNumber?1:-1}).map(function(e,t){return e.ETag}),"UPLOADING"==m[a.index].upFlag&&l.isComplete(a,r),h(!1,!0)):"UPLOADING"==m[a.index].upFlag&&l.uploadPart(a)},function(e){d=e.status,200!==(c=e).status&&(console.error("doUploadPart failed, file: ".concat(m[a.index].videoFile.name,", partNumber: ").concat(i,", totalNumber: ").concat(a.partCount)),l.isAppException(e.status)?(m[a.index].upFlag="MAJOR_FAILED",e=callbackMsg(1,e,"文件名："+m[a.index].videoFile.name+"，上传第"+i+"段任务失败，请重试"),l.onUploadFailed&&l.onUploadFailed(l.utils.assetInfo(m[a.index]),e)):m[a.index].upFlag="FAILED",l.resetCurrentTask(a.index,o)),h(!0,!1)})},function(e){f=!1,d=e.status,c=e,console.error("doUploadPart get auth failed, file: ".concat(m[a.index].videoFile.name,", partNumber: ").concat(i,", totalNumber: ").concat(a.partCount)),200!==e.status&&l.uploadFailHandle(l,a.index,e),h(!0,!1)})},isComplete:function(o,e){var n=this,r=o.file.name,t=o.partCount,e="string"==typeof e?JSON.parse(e):e,i=n.utils.utilFunctions.createXmlDOC(e,t),e={http_verb:"POST",upload_id:o.uploadId,bucket:o.bucketName,object_key:o.objectKey},a="",s="",l=!1;function u(e){e={uploadId:o.uploadId,internalManageAsset:m[o.index].internalManageAsset,endTime:(new Date).getTime(),authorizationStatus:l,result:e,errorCode:a,errorMsg:s};n.reportManage.setCompleteInfo(e)}n.service.getAuthorization(e).then(function(e){l=!0;e={sign_str:e.sign_str.replace(/&amp;/g,"&"),bucket:o.bucketName,object_key:o.objectKey,upload_id:o.uploadId};"COMPLETE"!=m[o.index].upFlag||m[o.index].internalManageAsset?("COMPLETE"==m[o.index].upFlag&&m[o.index].internalManageAsset&&(console.log("upload file has completed, but need to confirm"),n.confirmAsset(o)),n.service.completeMultipartUpload(e,{xmlDoc:i}).then(function(e,t,r){console.log("upload and merge file: ".concat(m[o.index].videoFile.name," Complete, resp:",JSON.stringify(r))),m[o.index].progress=100,m[o.index].upFlag="COMPLETE",n.onUploadProgress&&n.onUploadProgress(n.utils.assetInfo(m[o.index])),m[o.index].internalManageAsset?n.confirmAsset(o):(n.onUploadSucceed&&n.onUploadSucceed(n.utils.assetInfo(m[o.index])),n.startUpload()),u(0)},function(e){var t;a=e.status,s=e,console.error("merge file: ".concat(m[o.index].videoFile.name," failed")),n.isAppException(e.status)?(t=callbackMsg(1,e,"file name："+r+",complete upload failed, pls retry!"),m[o.index].upFlag="MAJOR_FAILED",400!==e.status?(n.onUploadFailed&&n.onUploadFailed(n.utils.assetInfo(m[o.index]),t),u(1)):(m[o.index].upFlag="WAITING",m[o.index].uploadedIndexes=[],m[o.index].progress=0,n.startUpload())):(m[o.index].upFlag="FAILED",u(1))})):console.log("upload file has completed, not need to repeat complete, partCount=".concat(t))},function(e){a=e.status,s=e,console.error("merge file: ".concat(m[o.index].videoFile.name,", get auth failed")),200!==e.status&&n.uploadFailHandle(n,o.index,e),u(1)})},confirmAsset:function(t){var r=(new Date).getTime(),o="",n="",a=this;function s(e){e={uploadId:t.uploadId,startTime:r,endTime:(new Date).getTime(),result:e,errorCode:o,errorMsg:n};a.reportManage.setConfirmInfo(e)}Utils.isEmpty(m[t.index].asset_id)?console.error("confirm Asset info asset_id is empty!"):a.service.confirmAsset(m[t.index]).then(function(e){console.log("confirm file: "+m[t.index].videoFile.name+" success!"),m[t.index].upFlag="CONFIRM",a.onUploadSucceed&&a.onUploadSucceed(a.utils.assetInfo(m[t.index])),a.startUpload(),s(0)},function(e){o=e.status,n=e,console.error("confirm file: "+m[t.index].videoFile.name+" failed!"),m[t.index].upFlag="CONFIRM_FAILED";e=callbackMsg(1,e,"create asset failed, assetList[i].videoFile:"+m[i].videoFile.name);a.onUploadFailed&&a.onUploadFailed(a.utils.assetInfo(m[t.index]),e),s(1)})},cancelUpload:function(e){var t;return"UPLOADING"==m[e].upFlag?(t="success: Succeeded in canceling the file upload.",m[e].upFlag="CANCEL",this.startUpload()):"FAILED"==m[e].upFlag?(t="success: Succeeded in canceling the file upload.",m[e].upFlag="CANCEL"):t="warn: The file has been canceled,or not allow cancel.",console.log(t),t},restartUpload:function(e){var r=this,t=m[e].uploadedIndexes,o=m[e].uploadPartParameters,n="",i=m[e].videoFile,a=m[e].partCount;if("CONFIRM"===m[e].upFlag||"COMPLETE"===m[e].upFlag&&!m[e].internalManageAsset)n="warn: The file is being uploaded.";else if("CONFIRM_FAILED"==m[e].upFlag||"COMPLETE"===m[e].upFlag&&m[e].internalManageAsset)n="success: Start to confirm asset, asset_id: "+m[e].asset_id,r.confirmAsset(m[e].uploadPartParameters);else if("CANCEL"==m[e].upFlag||"EXPIRED"==m[e].upFlag||"FAILED"==m[e].upFlag||"MAJOR_FAILED"==m[e].upFlag)for(var s,l,u,n="success: Start to restart the upload.",p=0;p<a;p++){if(!0!==t[p]){0===p?(m[e].upFlag="WAITING",m[e].uploadedIndexes=[],r.startUpload()):(u=p*o.partSize,s=p+1===a?o.fileSize:u+r.partSize,l=(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice).call(i,u,s),o.currentPartIndex=p+1,m[e].upFlag="UPLOADING",r.utils.genMd5(l,function(e,t){r.doUploadPart(p+1,o,l,t)}));break}p===a-1&&("COMPLETE"!==m[e].upFlag?(u=o.parts.sort(function(e,t){return e.PartNumber>=t.PartNumber?1:-1}).map(function(e){return e.ETag}),m[e].upFlag="UPLOADING",r.isComplete(o,u)):n="warn: The file has been uploaded.")}return console.log(n),n},resetCurrentTask:function(t,r){var o=m[t].uploadFilePublicParam.globalContext.currentTask;o.forEach(function(e){e===r&&(0<m[t].uploadFilePublicParam.globalContext.currentTaskNum&&m[t].uploadFilePublicParam.globalContext.currentTaskNum--,o.splice(o.indexOf(r),1))})},autoRecoverUploading:function(){var t=this;r=r||setInterval(function(){if(0!==m.length)for(var e=0;e<m.length;e++)["WAITING","CREATE_FAILED","COMPLETE","CONFIRM","REPEAT","CANCEL","EXPIRED","MAJOR_FAILED"].includes(m[e].upFlag)||0===m[e].uploadFilePublicParam.globalContext.currentTask.length&&t.restartUpload(e,console.log)},3e3)},isAppException:function(e){return[400,401,403,404,405,414].includes(e)},uploadFailHandle:function(e,t,r){var o;"FAILED"!==m[t].upFlag&&(o=/^4\d{2}$/.test("".concat(r.status)),o=0===r.status?this.checkTokenRefreshFrequency(o):o,m[t].retryCount<3&&e.onUploadTokenExpired&&o?(m[t].upFlag="EXPIRED",e.index=t,m[t].retryCount++,e.onUploadTokenExpired()):(e.isAppException(r.status)?(m[t].upFlag="MAJOR_FAILED",o=callbackMsg(1,r,"file name："+m[t].videoFile.name+",upload filed!"),e.onUploadFailed&&e.onUploadFailed(e.utils.assetInfo(m[t]),o)):m[t].upFlag="FAILED",m[t].retryCount=0))},checkTokenRefreshFrequency:function(e){var t,r,o;return sessionStorage?(t=!1,r=sessionStorage.getItem("last-expire-time"),6e5<(o=Date.now())-(r=null===r?0:r)&&(t=!0,sessionStorage.setItem("last-expire-time",o)),t||console.log("refresh token too fast, please try again later!"),t):(console.log("not support sessionStorage feature!"),e)},resumeUploadWithAuth:function(e,t,r){var o=this;o.service.ak=e,o.service.sk=t,o.service.security_token=r,m.forEach(function(e,t){"EXPIRED"==e.upFlag&&o.restartUpload(t)})},listAssets:function(){var t=this,r=[];return m.map(function(e){r.push(t.utils.assetInfo(e))}),r},delListsAsset:function(e){m[e]&&(Utils.isEmpty(m[e].uploadPartParameters)||Utils.isEmpty(m[e].uploadPartParameters.uploadId)||this.reportManage.delUploadResultInfos(m[e].uploadPartParameters.uploadId),(e=m.splice(e,1)[0]).uploadFilePublicParam.globalContext.currentTaskNum=e.uploadFilePublicParam.globalContext.maxTaskNum,e.uploadFilePublicParam.globalContext.currentTask.forEach(function(e){e.abort()}),e=null,m.length<1?(clearInterval(r),r=null):m.forEach(function(e,t){e.index=t,Utils.isEmpty(e.uploadPartParameters)||Utils.isEmpty(e.uploadPartParameters.index)||(e.uploadPartParameters.index=t)}))},checkUpload:function(e,t,r){var o=this,e=e.videoFile,n=e.size;o.utils.computeFirstKBMd5(e,function(e){o.service.checkVodDuplication(e,n).then(function(e){t&&t(e)}).catch(function(e){r&&r(e)})})},reportApiCall:function(e){return this.reportManage||console.log("report manage is null!"),this.reportManage.reportApiCall(e)}}}(),VodClient.prototype={constructor:VodClient,addAsset:function(r,o){var n=(new Date).getTime(),i=this;i.vodClintImpl.addAsset(r,function(e){var t={apiName:"API^web#VodClient$addAsset#APP^SDK",params:{options:r},startTime:n,exception:e.msg,ret:JSON.stringify({code:e.code})};i.vodClintImpl.reportApiCall(t).then(function(){},function(e){console.log("err"+e)}),o&&o(e)})},startUpload:function(e){var t=(new Date).getTime(),e=(this.vodClintImpl.startUpload(e),{apiName:"API^web#VodClient$startUpload#APP^SDK",params:{i:e},startTime:t,exception:"",ret:""});this.vodClintImpl.reportApiCall(e).then(function(){},function(e){console.log("err"+e)})},cancelUpload:function(e){var t=(new Date).getTime(),r=this.vodClintImpl.cancelUpload(e);this.vodClintImpl.reportApiCall({apiName:"API^web#VodClient$cancelUpload#APP^SDK",params:{index:e},startTime:t,exception:r,ret:""}).then(function(){},function(e){console.log("err"+e)})},restartUpload:function(e){var t=(new Date).getTime(),r=this.vodClintImpl.restartUpload(e);this.vodClintImpl.reportApiCall({apiName:"API^web#VodClient$restartUpload#APP^SDK",params:{index:e},startTime:t,exception:r,ret:""}).then(function(){},function(e){console.log("err"+e)})},resumeUploadWithAuth:function(e,t,r){var o=(new Date).getTime(),e=(this.vodClintImpl.resumeUploadWithAuth(e,t,r),Utils.anonymous(e)),t=Utils.anonymous(t),r=Utils.anonymous(r);this.vodClintImpl.reportApiCall({apiName:"API^web#VodClient$resumeUpload#APP^SDK",params:{ak:e,sk:t,security_token:r},startTime:o,exception:"",ret:""}).then(function(){},function(e){console.log("err"+e)})},listAssets:function(){var e=(new Date).getTime(),t=this.vodClintImpl.listAssets(),e={apiName:"API^web#VodClient$listAssets#APP^SDK",params:{},startTime:e,exception:"",ret:JSON.stringify({assetList:t})};return this.vodClintImpl.reportApiCall(e).then(function(){},function(e){console.log("err"+e)}),t},delListsAsset:function(e){var t=(new Date).getTime(),e=(this.vodClintImpl.delListsAsset(e),{apiName:"API^web#VodClient$delListsAsset#APP^SDK",params:{index:e},startTime:t,exception:"",ret:""});this.vodClintImpl.reportApiCall(e).then(function(){},function(e){console.log("err"+e)})}},VodClient.getVersion=function(){return"web_"+configs.SDK_VERSION+"_"+configs.COMMIT_ID},window.VodClient=VodClient});
